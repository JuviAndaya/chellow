<!doctype html>
<html>
  <head>
    <link rel="stylesheet" type="text/css"
      href="{{context_path}}/reports/19/output/">
    <title>
      Chellow &gt; Gas Supplies &gt; {{g_era.g_supply.id}} &gt;
      Era {{g_era.start_date|hh_format}} Edit
    </title>
    <style>
      label.aligned {
        width: 18em;
        float: left;
      }
    </style>
  </head>
  <body>
    <p>
      <a href="{{context_path}}/reports/1/output/">Chellow</a> &gt;
      <a href="{{context_path}}/reports/437/output/">Gas Supplies</a> &gt;
      <a href="{{context_path}}/reports/423/output/?g_supply_id={{g_era.g_supply.id}}">{{g_era.g_supply.id}}</a> &gt;
      Era {{g_era.start_date|hh_format}} Edit
    </p>
    {% if messages %}
      <ul>
        {% for message in messages %}
          <li>{{message}}</li>
        {% endfor %}
      </ul>
    {% endif %}
    
    {% if request.getMethod() == 'GET' and request.getParameter('delete') %}
      <form method="post" action=".">
        <fieldset>
          <legend>
            Are you sure you want to delete this era?
          </legend>
          <input type="hidden" name="g_era_id" value="{{g_era.id}}">
          <input type="submit" name="delete" value="Delete">
        </fieldset>
      </form>
      <p>
        <a href=".">Cancel</a>
      </p>
    {% else %}
      <table>
        <caption>Sites</caption>
        <thead>
          <tr>
            <th>Code</th>
            <th>Name</th>
            {% if site_g_eras|length > 1 %}
              <th></th>
              <th></th>
              <th></th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for site_g_era in site_g_eras %}
            <tr>
              <td>
                {{site_g_era.site.code}}
              </td>
              <td>
                {{site_g_era.site.name}}
              </td>
              {% if site_g_eras|length > 1 %}
                <td>
                  {% if site_g_era.is_physical %}
                    Located here
                  {% else %}
                    <form method="post" action=".">
                      <fieldset>
                        <input
                            type="hidden" name="g_era_id" value="{{g_era.id}}">
                        <input
                            type="hidden" name="site_id"
                            value="{{site_g_era.site.id}}">
                        <input type="submit" name="locate" value="Locate Here">
                      </fieldset>
                    </form>
                  {% endif %}
                </td>
                <td>
                  <form method="post" action=".">
                    <fieldset>
                      <legend>Detach from site</legend>
                      <input type="hidden" name="g_era_id" value="{{g_era.id}}">
                      <input
                          type="hidden" name="site_id"
                          value="{{site_g_era.site.id}}">
                      <input type="submit" name="detach" value="Detach">
                    </fieldset>
                  </form>
                </td>
              {% endif %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
     
      <br>
      <form method="post" action=".">
        <fieldset>
          <legend>Attach to another site</legend>
          <input type="hidden" name="g_era_id" value="{{g_era.id}}">
          <label>Site Code {{input_text("site_code", '')}}</label>
          <input type="submit" name="attach" value="Attach">
        </fieldset>
      </form>
      <br>
      <form action="." method="post">
        <fieldset>
          <input type="hidden" name="g_era_id" value="{{g_era.id}}">
          <legend>Update this era</legend>
          <fieldset>
            <legend>Start date</legend>
            {{input_date('start', g_era.start_date)}}
          </fieldset>
          <br>

          <fieldset>
            <legend>End Date</legend>
            <label>Ended?
            {{input_checkbox('is_ended', g_era.finish_date is not none)}}
            </label>
            {{input_date('finish', g_era.finish_date)}}
          </fieldset>

         
          <br>
          <label class="aligned">Meter Serial Number</label>
          {{input_text('msn', g_era.msn, 16)}}
          <br>
          <label class="aligned">Contract</label>
          <select name="g_contract_id">
            {% for g_contract in supplier_g_contracts %}
              {{input_option('g_contract_id', g_contract.id, g_contract.name, g_era.g_contract.id)}}
            {% endfor %}
          </select>
          <br>
          <label class="aligned">Account</label>
          {{input_text('account', g_era.account)}}
          <br>
          </fieldset>
          <br>
          <input type="submit" value="Update">
        </fieldset>
      </form>
      <br>
      {% if g_era.g_supply.g_eras|length > 1 %}
        <form action=".">
          <fieldset>
            <legend>Delete this era</legend>
            <input type="hidden" name="g_era_id" value="{{g_era.id}}">
            <input type="submit" name="delete" value="Delete">
          </fieldset>
        </form>
      {% endif %}
    {% endif %}
  </body>
</html>
